n = 5; % number of points per dimension
g = 9.8;

zero_to_one   = linspace(0.01,0.99,n);
zero_to_three = linspace(0.01,3,   n);

m0h   = zero_to_three;
a1_a2 = zero_to_one;
m0a2  = zero_to_three;
d1_h  = zero_to_one;
d2_d1 = zero_to_one;
a3_a2 = zero_to_three;

[M0H, A1_A2, M0A2, D1_H, D2_D1, A3_A2] = ndgrid(m0h, a1_a2, m0a2, d1_h, d2_d1, a3_a2);

A2_H = M0A2  ./ M0H;
A1_H = A1_A2 .* A2_H;
D2_H = D2_D1 .* D1_H;
A3_H = A3_A2 .* A2_H;

NMK = 10;
H = 1;

g_nondim = g; % fixme so mult works out
w_nondim = w; % fixme so mult works out

[A_f_over_rho, A_s_over_rho, A_c_over_rho, ...
 B_f_over_rho_w, B_s_over_rho_w, B_c_over_rho_w, ...
 gamma_f_over_rho_g, gamma_s_over_rho_g, ...
 gamma_phase_f, gamma_phase_s] = get_hydro_coeffs_MEEM(A2_H, M0H, D2_H, A1_H, ...
                                                       D1_H, A3_H, H, ...
                                                       g_nondim, w_nondim, ...
                                                       NMK, get_spar_exc(g));

% mult = M0H .* (1 - w2_over_gk.^2) + w2_over_gk;


[mag_U,phase_U,...
 real_P,reactive_P,...
 mag_X_u,phase_X_u,...
 mag_X_f,phase_X_f,...
 mag_X_s,phase_X_s,...
 B_p,K_p,P_sat_ratio] = get_response_drag(w,m_f,m_s,m_c,...
                                B_h_f,B_h_s,B_c,...
                                K_h_f,K_h_s,...
                                F_f_mag,F_f_phase,F_s_mag,F_s_phase,F_max,...
                                drag_const_f,drag_const_s,mag_v0_f,mag_v0_s,...
                                X_max,control_type,multibody,...
                                X_tol,phase_X_tol,max_drag_iters,...
                                drag_convergence_plot_on);
